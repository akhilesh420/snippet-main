<div class="postContainer" (click)='postView()'>
  <!-- post content -->
  <div *ngIf="(postContent$ | async) as content; else loading">
    <img  class="post-content "
          src={{content}}
          alt="post content"
          [ngClass]="!this.showDetails ? 'opacity-out-details' : 'opacity-in-details'"
          *ngIf='postType.includes("image")'>
    <video class='post-content '
           src={{content}}
           loop
           playsinline
           #videoPlayer
           [ngClass]="!this.showDetails ? 'opacity-out-details' : 'opacity-in-details'"
           *ngIf='postType.includes("video")'>
    </video>
    <div *ngIf="createPost">
      <img [src]="addIcon" alt="add" class="add-icon pointer" (click)="onAddClick('content')" style="width: 116px; height: 116px;">
    </div>
  </div>
  <!-- loading spinner -->
  <ng-template #loading>
      <app-loading-spinner class="center-absolute"></app-loading-spinner>
  </ng-template>
  <!-- post details -->
  <div class="postDetails"
      (click)="showComments ? showDetails = false : showDetails = !showDetails; showComments = false; holderToggle = false;">
    <div class="postTitle inline float-left pointer">
        {{postDetails.title}}
    </div>
    <div class="showDetails pointer inline float-right" [ngClass]="showDetails ? 'rotate-90-ccw' : 'rotate-90-cw'">
      <img src='/assets/icons/Post Icons/postdetailDropdown.svg'>
    </div>
    <div class = "fade-in-top" *ngIf="showDetails === true">
      <div class="post-metrics float-left">
        <!-- Holder List Button -->
        <div class="metrics pointer inline float-left height-auto textFontSize"
            (click)="getHolderList(); stopPropagation($event);"
            [hidden]="tutorial">
          <img src="assets/icons/Post Icons/holderlistSymbol.svg" [ngStyle]="{'height': holderText.offsetHeight.toString() + 'px'}">
          <span #holderText [ngStyle]="{'padding-left': (holderText.offsetHeight + 5).toString() + 'px'}">Holder List</span>
        </div>
        <!-- Metrics -->
        <div *ngIf="engagementRatio === 1  && !createPost" class="float-right">
          <!-- Views -->
          <div class="metrics height-auto">
            <img src=" /assets/icons/Post Icons/viewcounterSymbol.svg">
            <span [ngStyle]="{'padding-left': (holderText.offsetHeight + 5).toString() + 'px'}">{{views}}</span>
          </div>
          <!-- Collection -->
          <div class="metrics float-left height-auto">
            <img src="/assets/icons/Post Icons/collectedSymbol.svg">
            <span [ngStyle]="{'padding-left': (holderText.offsetHeight + 5).toString() + 'px'}">{{collected}}</span>
          </div>
        </div>
      </div>
      <!-- Description -->
      <div *ngIf="!holderToggle">
        <span class="float-left text-left"
              [ngClass]="engagementRatio === 1  && !createPost ? 'engaged' : 'reached'">{{postDetails.description}}</span>
      </div>
    </div>
    <!-- Holder List Popup -->
    <div class="holder-list-container" *ngIf="holderToggle" (click)="stopPropagation($event)">
      <div *ngIf="collectionList | async; let collection; else holderLoading">
        <!-- No holders -->
        <div *ngIf="collection.length === 0;" class="no-holders">
          <br>
          <p>No holders</p>
          <br>
        </div>
        <!-- Holder List -->
        <div class="holder-list">
          <app-holder *ngFor="let holder of collection" [uid]="holder.collectorID" [stickerSize]="stickerSize"></app-holder>
        </div>
      </div>
      <ng-template #holderLoading>
        <app-loading-spinner class="center-absolute"></app-loading-spinner>
      </ng-template>
    </div>
  </div>
  <!-- profile tab -->
  <div *ngIf="!fetchingWindow" class="profileTab bkgrd-opc" [ngClass]="showComments ? 'open-comment' : 'close-comment'">
    <!-- comment button -->
    <div *ngIf="!tutorial">
      <div class="commentButton"
          (click)="showComments = !showComments; showDetails = false; holderToggle = false;"
            style="cursor: pointer;" >
        <div class="hideExtra">
          <div class="buttonBackground bkgrd-opc">
          </div>
        </div>
        <img src="https://i.ibb.co/twfK1TW/icons-3x.png" alt="comment button">
      </div>
      <div *ngIf="showComments">
        <!-- Coming soon placeholder -->
        <div class="row">
          <div class="col align-self-center">
            <span class="temp">Coming soon!</span>
          </div>
        </div>
        <!-- <app-comments class="section" [postId]="postDetails.postId"></app-comments> -->
      </div>
    </div>
  </div>
  <!-- profile tab information -->
  <div *ngIf="!fetchingWindow" class="profileTab close-comment">
    <div class="post-info">
      <!-- Engagement Bar -->
      <div  class="engagementBar">
        <div class="engagement"
          [ngStyle]='engagementProp'>
        </div>
        <div class="bar"></div>
      </div>
      <!-- Profile details -->
      <div class="width-100" [ngStyle]='{"height": stickerSize}'>
        <div class="row no-margin no-padding">
          <div class="col-6 no-margin no-padding username-col" #usernameCol>
             <!-- Username -->
            <a style = "cursor: pointer;" [routerLink]='profileRoute'>
              <span class = "stickerMargin" [ngStyle]="{'opacity' : usernameFetch ? 1 : 0}" #usernameRef>
                {{username}}
              </span>
            </a>
          </div>
          <div class="col-6 no-margin no-padding">
            <div class="row no-margin no-padding"
                 *ngIf="!fetchingWindow && profileStickers$ | async as stickers">
              <div class="col"
                *ngFor="let i of getEmptySlots(stickers)"
                style="padding: 0px;">
              </div>
              <div class="col"
                  *ngFor="let sticker of stickers"
                   style="padding: 0px;"
                   align='right'>
                <app-sticker [pid]="sticker.pid" [size]="stickerSize"></app-sticker>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Post Sticker -->
    <a style="cursor: pointer;" (click)='collectSticker()'>
      <div class="postSticker"
        *ngIf="stickerContent$ | async as stickerContent">
        <img class="sticker-img"
             src={{stickerContent}}
             width="100%" alt="post content">
        <div *ngIf="createPost">
          <img [src]="addIcon" alt="add" class="center-absolute sticker-add" (click)="onAddClick('sticker')">
        </div>
      </div>
    </a>
  </div>
</div>
