<div class="postContainer" (click)='postView()'>
  <!-- post content -->
  <div *ngIf="(postContent$ | async) as content; else loading">
    <img  class="post-content "
          [src]='content'
          alt="post content"
          [ngClass]="!this.showDetails ? 'opacity-out-details' : 'opacity-in-details'"
          *ngIf='postType.includes("image")'>
    <video class='post-content '
           loop
           playsinline
           #videoPlayer
           [src]='content'
           [ngClass]="!this.showDetails ? 'opacity-out-details' : 'opacity-in-details'"
           *ngIf='postType.includes("video")'>
    </video>
  </div>
  <!-- loading spinner -->
  <ng-template #loading>
      <app-loading-spinner class="center-absolute"></app-loading-spinner>
  </ng-template>
  <!-- post details -->
  <div class="postDetails"
      (click)="showComments ? showDetails = false : showDetails = !showDetails;
              showComments = false;
              holderToggle = false;
              playFailSafe = false;
              allowToggle = true;
              videoToggle();">
    <div class="postTitle inline float-left pointer">
        {{postDetails.title}}
    </div>
    <div class="showDetails pointer inline float-right" [ngClass]="showDetails ? 'rotate-90-ccw' : 'rotate-90-cw'">
      <img src='/assets/icons/Post Icons/postdetailDropdown.svg'>
    </div>
    <div class = "fade-in-top" *ngIf="showDetails === true">
      <div class="post-metrics float-left">
        <!-- Holder List Button -->
        <div class="metrics pointer inline float-left height-auto textFontSize"
            (click)="getHolderList(); stopPropagation($event);">
          <img src="assets/icons/Post Icons/holderlistSymbol.svg" [ngStyle]="{'height': holderText.offsetHeight.toString() + 'px'}">
          <span #holderText [ngStyle]="{'padding-left': (holderText.offsetHeight + 5).toString() + 'px'}">Holder List</span>
        </div>
        <!-- Metrics -->
        <div *ngIf="engagementRatio === 1" class="float-right">
          <!-- Views -->
          <div class="metrics height-auto">
            <img src="/assets/icons/Profile Display/viewsIcon.svg">
            <span [ngStyle]="{'padding-left': (holderText.offsetHeight + 5).toString() + 'px'}">{{views}}</span>
          </div>
          <!-- Collection -->
          <div class="metrics float-left height-auto">
            <img src="/assets/icons/Profile Display/collectionSymbol.svg">
            <span [ngStyle]="{'padding-left': (holderText.offsetHeight + 5).toString() + 'px'}">{{collected}}</span>
          </div>
        </div>
      </div>
      <!-- Description -->
      <div *ngIf="!holderToggle">
        <span class="float-left text-left"
              [ngClass]="engagementRatio === 1 ? 'engaged' : 'reached'">{{postDetails.description}}</span>
      </div>
    </div>
    <!-- Holder List Popup -->
    <div class="holder-list-container" *ngIf="holderToggle" (click)="stopPropagation($event)">
      <div *ngIf="collectionList | async; let collection; else holderLoading">
        <!-- No holders -->
        <div *ngIf="collection.length === 0;" class="no-holders">
          <br>
          <p>No holders</p>
          <br>
        </div>
        <!-- Holder List -->
        <div class="holder-list">
          <app-holder *ngFor="let holder of collection" [uid]="holder.collectorID"></app-holder>
        </div>
      </div>
      <ng-template #holderLoading>
        <app-loading-spinner class="center-absolute"></app-loading-spinner>
      </ng-template>
    </div>
  </div>
  <app-profile-tab [uid]='uid' [pid]='pid' (views)='views' (collected)='collected' (engagementRatio)='engagementRatio'></app-profile-tab>
    <!-- Fail-safe button -->
    <div class = "fail-safe" *ngIf='playFailSafe' (click)='playFailSafe = false; allowToggle = true; videoToggle();'>
      <img src = "assets/icons/Post Icons/failSafeButton.png">
    </div>
</div>
